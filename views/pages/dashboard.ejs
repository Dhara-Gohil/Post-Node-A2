<h2>Dashboard</h2>

<% if (user) { %>
  <p>Welcome <%= user.email %></p>
<% } else { %>
  <p>No user session found</p>
<% } %>

<h3>Add Transaction</h3>

<form method="POST" action="/transactions">

  <input name="amount" type="number" placeholder="Amount" required />

  <select name="type">
    <option value="expense">Expense</option>
    <option value="income">Income</option>
  </select>

  <select name="account" required>
    <% accounts.forEach(function(acc){ %>
      <option value="<%= acc.id %>">
        <%= acc.name %>
      </option>
    <% }) %>
  </select>

  <input name="note" placeholder="Note (optional)" />

  <button type="submit">Add</button>

</form>

<h3>Your Accounts</h3>

<button type="button" onclick="toggleAccountForm()">Add Account</button>

<div id="accountForm" style="display:none; margin-top:10px;">

  <form method="POST" action="/accounts">
    <input name="name" placeholder="Account name" required />

    <select name="type">
      <option value="cash">Cash</option>
      <option value="bank">Bank</option>
      <option value="wallet">Wallet</option>
      <option value="upi">UPI</option>
    </select>

    <button type="submit">Save</button>
  </form>

</div>
<p>Total Balance: ₹<%= totalBalance %></p> <a href="/transactions">View Full History</a>
<ul>
  <% accounts.forEach(function(acc){ %>

    <li style="margin-bottom:8px;">

      <strong><%= acc.name %></strong>
      ( <%= acc.type %> )
      — Balance: ₹<%= acc.balance %>

      <!-- rename toggle -->
      <button type="button" onclick="toggleRename('<%= acc.id %>')">Rename</button>

      <!-- delete -->
      <form method="POST" action="/accounts/delete" style="display:inline;">
        <input type="hidden" name="id" value="<%= acc.id %>" />
        <button type="submit">Delete</button>
      </form>

      <!-- hidden rename form -->
      <div id="rename-<%= acc.id %>" style="display:none; margin-top:5px;">

        <form method="POST" action="/accounts/update">

  <input type="hidden" name="id" value="<%= acc.id %>" />

  <input name="name" value="<%= acc.name %>" required />

  <button type="submit">Save</button>

</form>


      </div>

    </li>

  <% }) %>
</ul>


<form method="POST" action="/logout">
  <button type="submit">Logout</button>
</form>
<script>
  function toggleAccountForm() {
    const form = document.getElementById("accountForm");
    if (!form) return;
    form.style.display = form.style.display === "none" ? "block" : "none";
  }
</script>
<script>
  function toggleRename(id){
    const row = document.getElementById("rename-" + id);
    if(!row) return;

    if(row.style.display === "none" || row.style.display === ""){
      row.style.display = "block";
    } else {
      row.style.display = "none";
    }
  }
</script>

